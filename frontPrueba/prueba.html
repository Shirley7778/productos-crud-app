const API_URL = "http://localhost:8080/Producto";

// Cargar todos los productos
async function cargarProductos() {
    const res = await fetch(API_URL);
    const data = await res.json();

    const productos = data._embedded.productoes; // CORREGIDO según Spring Data REST

    const tbody = document.querySelector("#productosTabla tbody");
    tbody.innerHTML = "";

    productos.forEach(producto => {
        // Extraemos el id de la URL
        const id = producto._links.self.href.split("/").pop();

        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${id}</td>
            <td>${producto.nombre.toUpperCase()}</td>
            <td>${producto.precio}</td>
            <td>${producto.stock}</td>
            <td>
                <button class="editar" onclick="editarProducto('${id}', '${producto.nombre}', ${producto.precio}, ${producto.stock})">Editar</button>
                <button class="eliminar" onclick="eliminarProducto('${producto.id}')">Eliminar</button>
            </td>
        `;
        tbody.appendChild(tr);
    });
}

// Crear o actualizar producto
async function guardarProducto() {
    const id = document.getElementById("productoId").value;
    const nombre = document.getElementById("nombre").value.toUpperCase();;
    const precio = parseFloat(document.getElementById("precio").value);
    const stock = parseInt(document.getElementById("stock").value);

    const producto = { nombre, precio, stock };

    let metodo = "POST";
    let url = API_URL;

    if (id) {
        metodo = "PUT";
        url = `${API_URL}/${id}`;
    }

    await fetch(url, {
        method: metodo,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(producto)
    });

    limpiarFormulario();
    cargarProductos();
}

// Cargar datos en el formulario para editar
function editarProducto(id, nombre, precio, stock) {
    document.getElementById("productoId").value = id;
    document.getElementById("nombre").value = nombre;
    document.getElementById("precio").value = precio;
    document.getElementById("stock").value = stock;
}

// Eliminar producto
async function eliminarProducto(id) {
    await fetch(`${API_URL}/${id}`, { method: "DELETE" });
    cargarProductos();
}

// Limpiar formulario
function limpiarFormulario() {
    document.getElementById("productoId").value = "";
    document.getElementById("nombre").value = "";
    document.getElementById("precio").value = "";
    document.getElementById("stock").value = "";
}

// Cargar productos al abrir la página
cargarProductos();
